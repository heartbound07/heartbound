FROM node:18-bullseye

WORKDIR /app

# Yarn is already installed in this Node image, so we don't need to install it again.
# RUN npm install -g yarn

# Copy package files first
COPY package.json ./
# If you have a yarn.lock, copy it too
# COPY yarn.lock ./
RUN yarn install

# No need for COPY . . here since we'll mount the directory at runtime
# The COPY . . is causing conflicts with the volume mounts

# Expose port 3000
EXPOSE 3000

# Set environment variable to skip native Rollup module loading
ENV ROLLUP_SKIP_NATIVE=1

# Run the Vite dev server explicitly on port 3000 and bind to 0.0.0.0
CMD ["yarn", "dev", "--", "--host", "0.0.0.0", "--port", "3000"]